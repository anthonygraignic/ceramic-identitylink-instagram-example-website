import{S as Ie,i as Ee,s as we,l as ae,f as C,r as $e,u as ne,w as Ve,x as oe,d as n,E as ie,H as Ye,I as Ue,J as Be,K as Oe,e as p,j as Ce,c as m,a as v,m as Ae,b as h,o as De,F as Pe,v as Le,t as E,g as w,D as s,h as se,k as T,R as Fe,n as q,A as Me,T as je,O as Se,U as Re,P as ue,Q as fe}from"../chunks/vendor-f64f282c.js";import{c as Ke,C as ze,s as We,d as He,p as Je,v as de}from"../chunks/ConnectButton-83784455.js";function Ge(c){let e;const l=c[2].default,r=Ye(l,c,c[1],null);return{c(){r&&r.c()},l(t){r&&r.l(t)},m(t,o){r&&r.m(t,o),e=!0},p(t,o){r&&r.p&&(!e||o&2)&&Ue(r,l,t,t[1],e?Oe(l,t[1],o,null):Be(t[1]),null)},i(t){e||(oe(r,t),e=!0)},o(t){ne(r,t),e=!1},d(t){r&&r.d(t)}}}function Qe(c){let e,l,r;return l=new ze({}),{c(){e=p("div"),Ce(l.$$.fragment),this.h()},l(t){e=m(t,"DIV",{class:!0});var o=v(e);Ae(l.$$.fragment,o),o.forEach(n),this.h()},h(){h(e,"class","only-connected svelte-fro8eb")},m(t,o){C(t,e,o),De(l,e,null),r=!0},p:Pe,i(t){r||(oe(l.$$.fragment,t),r=!0)},o(t){ne(l.$$.fragment,t),r=!1},d(t){t&&n(e),Le(l)}}}function Xe(c){let e,l,r,t;const o=[Qe,Ge],a=[];function g(u,d){return u[0]?1:0}return e=g(c),l=a[e]=o[e](c),{c(){l.c(),r=ae()},l(u){l.l(u),r=ae()},m(u,d){a[e].m(u,d),C(u,r,d),t=!0},p(u,[d]){let k=e;e=g(u),e===k?a[e].p(u,d):($e(),ne(a[k],1,1,()=>{a[k]=null}),Ve(),l=a[e],l?l.p(u,d):(l=a[e]=o[e](u),l.c()),oe(l,1),l.m(r.parentNode,r))},i(u){t||(oe(l),t=!0)},o(u){ne(l),t=!1},d(u){a[e].d(u),u&&n(r)}}}function Ze(c,e,l){let r;ie(c,Ke,a=>l(0,r=a));let{$$slots:t={},$$scope:o}=e;return c.$$set=a=>{"$$scope"in a&&l(1,o=a.$$scope)},[r,o,t]}class xe extends Ie{constructor(e){super();Ee(this,e,Ze,Xe,we,{})}}function et(c){let e,l,r,t,o,a,g,u,d,k,A,I=c[4]&&Te(c);return{c(){e=p("h2"),l=E("Success \u{1F973}"),r=T(),t=p("p"),o=E(`We successfully issued a Verifiable Credential that link a decentralized identifier (DID)
					to your Instagram account on Ceramic network.
					`),a=p("br"),g=E(`
					We added it to your AKA (Also Known As) Accounts.`),u=T(),d=p("br"),k=T(),I&&I.c(),A=ae()},l(i){e=m(i,"H2",{});var y=v(e);l=w(y,"Success \u{1F973}"),y.forEach(n),r=q(i),t=m(i,"P",{});var L=v(t);o=w(L,`We successfully issued a Verifiable Credential that link a decentralized identifier (DID)
					to your Instagram account on Ceramic network.
					`),a=m(L,"BR",{}),g=w(L,`
					We added it to your AKA (Also Known As) Accounts.`),L.forEach(n),u=q(i),d=m(i,"BR",{}),k=q(i),I&&I.l(i),A=ae()},m(i,y){C(i,e,y),s(e,l),C(i,r,y),C(i,t,y),s(t,o),s(t,a),s(t,g),C(i,u,y),C(i,d,y),C(i,k,y),I&&I.m(i,y),C(i,A,y)},p(i,y){i[4]?I?I.p(i,y):(I=Te(i),I.c(),I.m(A.parentNode,A)):I&&(I.d(1),I=null)},d(i){i&&n(e),i&&n(r),i&&n(t),i&&n(u),i&&n(d),i&&n(k),I&&I.d(i),i&&n(A)}}}function tt(c){let e,l,r,t,o,a,g,u,d,k,A,I,i,y,L,Y,N=c[7].id+"",P,F,b,S,_,R,D,U;function K(f,V){return f[6]?nt:rt}let M=K(c),$=M(c);return{c(){e=p("h2"),l=E("Confirm"),r=T(),t=p("p"),o=E("You successfully authenticated on "),a=p("b"),g=E("Instagram"),u=E(` \u{1F44F}, now generate the proof by clicking on
					the following button:`),d=T(),k=p("div"),A=p("button"),I=p("div"),$.c(),i=T(),y=p("p"),L=E("Your DID: "),Y=p("b"),P=E(N),F=T(),b=p("p"),S=E("Your challenge code: "),_=p("b"),R=E(c[1]),this.h()},l(f){e=m(f,"H2",{});var V=v(e);l=w(V,"Confirm"),V.forEach(n),r=q(f),t=m(f,"P",{});var z=v(t);o=w(z,"You successfully authenticated on "),a=m(z,"B",{});var te=v(a);g=w(te,"Instagram"),te.forEach(n),u=w(z,` \u{1F44F}, now generate the proof by clicking on
					the following button:`),z.forEach(n),d=q(f),k=m(f,"DIV",{class:!0});var le=v(k);A=m(le,"BUTTON",{class:!0});var H=v(A);I=m(H,"DIV",{class:!0});var re=v(I);$.l(re),re.forEach(n),H.forEach(n),le.forEach(n),i=q(f),y=m(f,"P",{});var X=v(y);L=w(X,"Your DID: "),Y=m(X,"B",{});var j=v(Y);P=w(j,N),j.forEach(n),X.forEach(n),F=q(f),b=m(f,"P",{});var Z=v(b);S=w(Z,"Your challenge code: "),_=m(Z,"B",{});var x=v(_);R=w(x,c[1]),x.forEach(n),Z.forEach(n),this.h()},h(){h(I,"class","generate-button-content svelte-ktq9ns"),h(A,"class","svelte-ktq9ns"),h(k,"class","confirm svelte-ktq9ns")},m(f,V){C(f,e,V),s(e,l),C(f,r,V),C(f,t,V),s(t,o),s(t,a),s(a,g),s(t,u),C(f,d,V),C(f,k,V),s(k,A),s(A,I),$.m(I,null),C(f,i,V),C(f,y,V),s(y,L),s(y,Y),s(Y,P),C(f,F,V),C(f,b,V),s(b,S),s(b,_),s(_,R),D||(U=Se(A,"click",c[8]),D=!0)},p(f,V){M!==(M=K(f))&&($.d(1),$=M(f),$&&($.c(),$.m(I,null))),V&128&&N!==(N=f[7].id+"")&&se(P,N),V&2&&se(R,f[1])},d(f){f&&n(e),f&&n(r),f&&n(t),f&&n(d),f&&n(k),$.d(),f&&n(i),f&&n(y),f&&n(F),f&&n(b),D=!1,U()}}}function lt(c){let e,l,r,t,o,a,g=c[7].id+"",u,d,k,A,I,i,y,L,Y,N,P,F;return{c(){e=p("h2"),l=E("Verify"),r=T(),t=p("p"),o=E("Your DID: "),a=p("b"),u=E(g),d=T(),k=p("div"),A=p("label"),I=T(),i=p("input"),y=T(),L=p("a"),Y=E("Verify on Instagram"),this.h()},l(b){e=m(b,"H2",{});var S=v(e);l=w(S,"Verify"),S.forEach(n),r=q(b),t=m(b,"P",{});var _=v(t);o=w(_,"Your DID: "),a=m(_,"B",{});var R=v(a);u=w(R,g),R.forEach(n),_.forEach(n),d=q(b),k=m(b,"DIV",{class:!0});var D=v(k);A=m(D,"LABEL",{for:!0}),v(A).forEach(n),I=q(D),i=m(D,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,class:!0}),y=q(D),L=m(D,"A",{href:!0,class:!0});var U=v(L);Y=w(U,"Verify on Instagram"),U.forEach(n),D.forEach(n),this.h()},h(){h(A,"for","instagram-handle"),h(i,"type","text"),h(i,"name","instagram-handle"),h(i,"id","instagram-handle"),h(i,"placeholder","Instagram's handle e.g. wallkanda"),h(i,"class","svelte-ktq9ns"),h(L,"href",N=""+(de.IDENTITY_LINK_URL+"/api/v0/request-instagram?did="+c[7].id+"&username="+c[0])),h(L,"class","svelte-ktq9ns"),h(k,"class","verify svelte-ktq9ns")},m(b,S){C(b,e,S),s(e,l),C(b,r,S),C(b,t,S),s(t,o),s(t,a),s(a,u),C(b,d,S),C(b,k,S),s(k,A),s(k,I),s(k,i),Re(i,c[0]),s(k,y),s(k,L),s(L,Y),P||(F=Se(i,"input",c[10]),P=!0)},p(b,S){S&128&&g!==(g=b[7].id+"")&&se(u,g),S&1&&i.value!==b[0]&&Re(i,b[0]),S&129&&N!==(N=""+(de.IDENTITY_LINK_URL+"/api/v0/request-instagram?did="+b[7].id+"&username="+b[0]))&&h(L,"href",N)},d(b){b&&n(e),b&&n(r),b&&n(t),b&&n(d),b&&n(k),P=!1,F()}}}function Te(c){let e,l,r=c[4].data.attestation+"",t;return{c(){e=p("p"),l=E("Attestation: "),t=E(r)},l(o){e=m(o,"P",{});var a=v(e);l=w(a,"Attestation: "),t=w(a,r),a.forEach(n)},m(o,a){C(o,e,a),s(e,l),s(e,t)},p(o,a){a&16&&r!==(r=o[4].data.attestation+"")&&se(t,r)},d(o){o&&n(e)}}}function rt(c){let e;return{c(){e=E("Generate Verifiable Credential")},l(l){e=w(l,"Generate Verifiable Credential")},m(l,r){C(l,e,r)},d(l){l&&n(e)}}}function nt(c){let e,l,r,t,o,a;return{c(){e=ue("svg"),l=ue("circle"),r=ue("path"),t=T(),o=p("p"),a=E("Generating..."),this.h()},l(g){e=fe(g,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var u=v(e);l=fe(u,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),v(l).forEach(n),r=fe(u,"path",{class:!0,fill:!0,d:!0}),v(r).forEach(n),u.forEach(n),t=q(g),o=m(g,"P",{});var d=v(o);a=w(d,"Generating..."),d.forEach(n),this.h()},h(){h(l,"class","opacity-25"),h(l,"cx","12"),h(l,"cy","12"),h(l,"r","10"),h(l,"stroke","currentColor"),h(l,"stroke-width","4"),h(r,"class","opacity-75"),h(r,"fill","currentColor"),h(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),h(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white dark:text-black"),h(e,"xmlns","http://www.w3.org/2000/svg"),h(e,"fill","none"),h(e,"viewBox","0 0 24 24")},m(g,u){C(g,e,u),s(e,l),s(e,r),C(g,t,u),C(g,o,u),s(o,a)},d(g){g&&n(e),g&&n(t),g&&n(o)}}}function ot(c){let e;function l(o,a){if(o[3]==o[2].VERIFY)return lt;if(o[3]==o[2].CONFIRM)return tt;if(o[3]==o[2].SUCCESS)return et}let r=l(c),t=r&&r(c);return{c(){e=p("section"),t&&t.c(),this.h()},l(o){e=m(o,"SECTION",{class:!0});var a=v(e);t&&t.l(a),a.forEach(n),this.h()},h(){h(e,"class","svelte-ktq9ns")},m(o,a){C(o,e,a),t&&t.m(e,null)},p(o,a){r===(r=l(o))&&t?t.p(o,a):(t&&t.d(1),t=r&&r(o),t&&(t.c(),t.m(e,null)))},d(o){o&&n(e),t&&t.d()}}}function qe(c){let e,l;return{c(){e=p("p"),l=E(c[5]),this.h()},l(r){e=m(r,"P",{class:!0});var t=v(e);l=w(t,c[5]),t.forEach(n),this.h()},h(){h(e,"class","error svelte-ktq9ns")},m(r,t){C(r,e,t),s(e,l)},p(r,t){t&32&&se(l,r[5])},d(r){r&&n(e)}}}function st(c){let e,l,r,t,o,a,g,u,d,k,A,I,i,y,L,Y,N,P,F,b,S,_,R,D,U,K,M,$,f,V,z,te,le,H,re,X,j,Z,x;j=new xe({props:{$$slots:{default:[ot]},$$scope:{ctx:c}}});let O=c[5]&&qe(c);return{c(){e=T(),l=p("main"),r=p("section"),t=p("h1"),o=E("Verify your Instagram account through "),a=p("a"),g=E("Identity Link Services"),u=T(),d=p("p"),k=E("This project is an example of how you can issue a "),A=p("a"),I=E("verifiable credential"),i=E(`
			that link a decentralized identifier (DID) to your Instagram account on
			`),y=p("a"),L=E("Ceramic network"),Y=E(". It is configured on the "),N=p("b"),P=E("clay testnet"),F=E(" network."),b=T(),S=p("h2"),_=E("Instructions:"),R=T(),D=p("ol"),U=p("li"),K=E("Connect with Metamask and 3ID"),M=T(),$=p("li"),f=E(`Click on the button to authorize our app to access your Instagram account (you will be
				redirected to Instagram Log In).`),V=T(),z=p("li"),te=E("Authorize our app (read-only access), you will be redirected to this same page."),le=T(),H=p("li"),re=E("Connect again and generate your verifiable credential by clicking on the button"),X=T(),Ce(j.$$.fragment),Z=T(),O&&O.c(),this.h()},l(B){Fe('[data-svelte="svelte-1t13h6n"]',document.head).forEach(n),e=q(B),l=m(B,"MAIN",{class:!0});var W=v(l);r=m(W,"SECTION",{class:!0});var J=v(r);t=m(J,"H1",{});var ce=v(t);o=w(ce,"Verify your Instagram account through "),a=m(ce,"A",{href:!0,rel:!0,target:!0});var _e=v(a);g=w(_e,"Identity Link Services"),_e.forEach(n),ce.forEach(n),u=q(J),d=m(J,"P",{});var G=v(d);k=w(G,"This project is an example of how you can issue a "),A=m(G,"A",{href:!0,rel:!0,target:!0});var he=v(A);I=w(he,"verifiable credential"),he.forEach(n),i=w(G,`
			that link a decentralized identifier (DID) to your Instagram account on
			`),y=m(G,"A",{href:!0,rel:!0,target:!0});var pe=v(y);L=w(pe,"Ceramic network"),pe.forEach(n),Y=w(G,". It is configured on the "),N=m(G,"B",{});var me=v(N);P=w(me,"clay testnet"),me.forEach(n),F=w(G," network."),G.forEach(n),b=q(J),S=m(J,"H2",{});var ve=v(S);_=w(ve,"Instructions:"),ve.forEach(n),R=q(J),D=m(J,"OL",{class:!0});var Q=v(D);U=m(Q,"LI",{});var be=v(U);K=w(be,"Connect with Metamask and 3ID"),be.forEach(n),M=q(Q),$=m(Q,"LI",{});var ye=v($);f=w(ye,`Click on the button to authorize our app to access your Instagram account (you will be
				redirected to Instagram Log In).`),ye.forEach(n),V=q(Q),z=m(Q,"LI",{});var ge=v(z);te=w(ge,"Authorize our app (read-only access), you will be redirected to this same page."),ge.forEach(n),le=q(Q),H=m(Q,"LI",{});var ke=v(H);re=w(ke,"Connect again and generate your verifiable credential by clicking on the button"),ke.forEach(n),Q.forEach(n),J.forEach(n),X=q(W),Ae(j.$$.fragment,W),Z=q(W),O&&O.l(W),W.forEach(n),this.h()},h(){document.title="Ceramic Identity Link - Instagram",h(a,"href","https://github.com/ceramicstudio/identitylink-services"),h(a,"rel","external noopener"),h(a,"target","_blank"),h(A,"href","https://www.w3.org/TR/vc-data-model/"),h(A,"rel","external noopener"),h(A,"target","_blank"),h(y,"href","https://ceramic.network/"),h(y,"rel","external noopener"),h(y,"target","_blank"),h(D,"class","instructions svelte-ktq9ns"),h(r,"class","svelte-ktq9ns"),h(l,"class","svelte-ktq9ns")},m(B,ee){C(B,e,ee),C(B,l,ee),s(l,r),s(r,t),s(t,o),s(t,a),s(a,g),s(r,u),s(r,d),s(d,k),s(d,A),s(A,I),s(d,i),s(d,y),s(y,L),s(d,Y),s(d,N),s(N,P),s(d,F),s(r,b),s(r,S),s(S,_),s(r,R),s(r,D),s(D,U),s(U,K),s(D,M),s(D,$),s($,f),s(D,V),s(D,z),s(z,te),s(D,le),s(D,H),s(H,re),s(l,X),De(j,l,null),s(l,Z),O&&O.m(l,null),x=!0},p(B,[ee]){const W={};ee&524511&&(W.$$scope={dirty:ee,ctx:B}),j.$set(W),B[5]?O?O.p(B,ee):(O=qe(B),O.c(),O.m(l,null)):O&&(O.d(1),O=null)},i(B){x||(oe(j.$$.fragment,B),x=!0)},o(B){ne(j.$$.fragment,B),x=!1},d(B){B&&n(e),B&&n(l),Le(j),O&&O.d()}}}const ut=!0,Ne="instagram.com";function at(c,e,l){let r,t,o;ie(c,We,_=>l(7,r=_)),ie(c,He,_=>l(13,t=_)),ie(c,Je,_=>l(14,o=_));var a;let g,u=o.query.get("code")||"",d=((a=o.query.get("state"))===null||a===void 0?void 0:a.replace("#_",""))||"";console.log(d?`Challenge Code: ${d}`:"No challenge code found in URL Query Params, starting at step 1: VERIFY");const k=o.query.get("error"),A=o.query.get("error_reason"),I=o.query.get("error_description");var i;(function(_){_[_.VERIFY=0]="VERIFY",_[_.CONFIRM=1]="CONFIRM",_[_.SUCCESS=2]="SUCCESS"})(i||(i={}));let y=u?i.CONFIRM:i.VERIFY,L,Y,N=!1;Me(()=>{var _;k&&l(5,Y=`Facebook Login Error: ${k}, ${A}, ${I}`);const R=new URLSearchParams(window.location.search);u=R.get("code")||"",l(1,d=((_=R.get("state"))===null||_===void 0?void 0:_.replace("#_",""))||"")});async function P(){try{l(6,N=!0);const _=await t.createJWS({challengeCode:d});console.log(_);const R=await fetch(`${de.IDENTITY_LINK_URL}/api/v0/confirm-instagram`,{method:"post",body:JSON.stringify({jws:_,code:u})});if(!R.ok){let D="";try{l(4,L=await R.json()),console.log(L),D=L.message}catch(U){console.log(U)}throw l(5,Y=`There was a problem: ${R.status} status code, ${D}`),new Error(Y)}l(4,L=await R.json()),console.log(L),l(3,y=i.SUCCESS),await b(L.data.attestation),alert("Congrats, you linked your Instagram account to your 3ID account with a Verifiable Credential.")}catch(_){console.error(_),l(5,Y=_)}finally{l(6,N=!1)}}function F(_){return je(_).payload.vc.credentialSubject.account.username}async function b(_){var R,D,U;const K=(D=await((R=r.client.dataStore.get("alsoKnownAs",t.id))===null||R===void 0?void 0:R.accounts))!==null&&D!==void 0?D:[],M=F(_),$=K.find(f=>f.host===Ne&&f.id===M);$==null?K.push({protocol:"https",host:Ne,id:M,attestations:[{"did-jwt-vc":_}]}):($.attestations=(U=$.attestations)!==null&&U!==void 0?U:[],$.attestations.push({"did-jwt-vc":_})),await r.client.dataStore.set("alsoKnownAs",{accounts:K}),console.log("Added attestation to AlsoKnownAsAccounts")}function S(){g=this.value,l(0,g)}return[g,d,i,y,L,Y,N,r,P,b,S]}class ft extends Ie{constructor(e){super();Ee(this,e,at,st,we,{addInstagramAttestation:9})}get addInstagramAttestation(){return this.$$.ctx[9]}}export{ft as default,ut as prerender};
