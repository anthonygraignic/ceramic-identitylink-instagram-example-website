import{S as Ie,i as Ee,s as we,l as se,f as C,r as $e,u as ne,w as Ve,x as oe,d as n,E as ae,H as Ye,I as Be,J as Oe,K as Ue,e as h,j as Ce,c as p,a as m,m as Ae,b as _,o as De,F as je,v as Le,t as E,g as w,D as s,h as ie,k as T,R as Fe,n as q,A as Me,T as Pe,O as Se,U as Te,P as ue,Q as fe}from"../chunks/vendor-365263c8.js";import{c as Ke,C as ze,s as We,d as He,p as Je,v as de}from"../chunks/ConnectButton-5468e10c.js";import"near-api-js";function Ge(c){let e;const l=c[2].default,r=Ye(l,c,c[1],null);return{c(){r&&r.c()},l(t){r&&r.l(t)},m(t,o){r&&r.m(t,o),e=!0},p(t,o){r&&r.p&&(!e||o&2)&&Be(r,l,t,t[1],e?Ue(l,t[1],o,null):Oe(t[1]),null)},i(t){e||(oe(r,t),e=!0)},o(t){ne(r,t),e=!1},d(t){r&&r.d(t)}}}function Qe(c){let e,l,r;return l=new ze({}),{c(){e=h("div"),Ce(l.$$.fragment),this.h()},l(t){e=p(t,"DIV",{class:!0});var o=m(e);Ae(l.$$.fragment,o),o.forEach(n),this.h()},h(){_(e,"class","only-connected svelte-fro8eb")},m(t,o){C(t,e,o),De(l,e,null),r=!0},p:je,i(t){r||(oe(l.$$.fragment,t),r=!0)},o(t){ne(l.$$.fragment,t),r=!1},d(t){t&&n(e),Le(l)}}}function Xe(c){let e,l,r,t;const o=[Qe,Ge],a=[];function k(u,d){return u[0]?1:0}return e=k(c),l=a[e]=o[e](c),{c(){l.c(),r=se()},l(u){l.l(u),r=se()},m(u,d){a[e].m(u,d),C(u,r,d),t=!0},p(u,[d]){let g=e;e=k(u),e===g?a[e].p(u,d):($e(),ne(a[g],1,1,()=>{a[g]=null}),Ve(),l=a[e],l?l.p(u,d):(l=a[e]=o[e](u),l.c()),oe(l,1),l.m(r.parentNode,r))},i(u){t||(oe(l),t=!0)},o(u){ne(l),t=!1},d(u){a[e].d(u),u&&n(r)}}}function Ze(c,e,l){let r;ae(c,Ke,a=>l(0,r=a));let{$$slots:t={},$$scope:o}=e;return c.$$set=a=>{"$$scope"in a&&l(1,o=a.$$scope)},[r,o,t]}class xe extends Ie{constructor(e){super();Ee(this,e,Ze,Xe,we,{})}}function et(c){let e,l,r,t,o,a,k,u,d,g,A,I=c[3]&&qe(c);return{c(){e=h("h2"),l=E("Success \u{1F973}"),r=T(),t=h("p"),o=E(`We successfully issued a Verifiable Credential that link a decentralized identifier (DID)
					to your Instagram account on Ceramic network.
					`),a=h("br"),k=E(`
					We added it to your AKA (Also Known As) Accounts.`),u=T(),d=h("br"),g=T(),I&&I.c(),A=se()},l(i){e=p(i,"H2",{});var y=m(e);l=w(y,"Success \u{1F973}"),y.forEach(n),r=q(i),t=p(i,"P",{});var L=m(t);o=w(L,`We successfully issued a Verifiable Credential that link a decentralized identifier (DID)
					to your Instagram account on Ceramic network.
					`),a=p(L,"BR",{}),k=w(L,`
					We added it to your AKA (Also Known As) Accounts.`),L.forEach(n),u=q(i),d=p(i,"BR",{}),g=q(i),I&&I.l(i),A=se()},m(i,y){C(i,e,y),s(e,l),C(i,r,y),C(i,t,y),s(t,o),s(t,a),s(t,k),C(i,u,y),C(i,d,y),C(i,g,y),I&&I.m(i,y),C(i,A,y)},p(i,y){i[3]?I?I.p(i,y):(I=qe(i),I.c(),I.m(A.parentNode,A)):I&&(I.d(1),I=null)},d(i){i&&n(e),i&&n(r),i&&n(t),i&&n(u),i&&n(d),i&&n(g),I&&I.d(i),i&&n(A)}}}function tt(c){let e,l,r,t,o,a,k,u,d,g,A,I,i,y,L,V,R=c[6].id+"",j,F,v,S,b,N,D,B;function K(f,Y){return f[5]?nt:rt}let M=K(c),$=M(c);return{c(){e=h("h2"),l=E("Confirm"),r=T(),t=h("p"),o=E("You successfully authenticated on "),a=h("b"),k=E("Instagram"),u=E(` \u{1F44F}, now generate the proof by clicking on
					the following button:`),d=T(),g=h("div"),A=h("button"),I=h("div"),$.c(),i=T(),y=h("p"),L=E("Your DID: "),V=h("b"),j=E(R),F=T(),v=h("p"),S=E("Your challenge code: "),b=h("b"),N=E(c[7]),this.h()},l(f){e=p(f,"H2",{});var Y=m(e);l=w(Y,"Confirm"),Y.forEach(n),r=q(f),t=p(f,"P",{});var z=m(t);o=w(z,"You successfully authenticated on "),a=p(z,"B",{});var te=m(a);k=w(te,"Instagram"),te.forEach(n),u=w(z,` \u{1F44F}, now generate the proof by clicking on
					the following button:`),z.forEach(n),d=q(f),g=p(f,"DIV",{class:!0});var le=m(g);A=p(le,"BUTTON",{class:!0});var H=m(A);I=p(H,"DIV",{class:!0});var re=m(I);$.l(re),re.forEach(n),H.forEach(n),le.forEach(n),i=q(f),y=p(f,"P",{});var X=m(y);L=w(X,"Your DID: "),V=p(X,"B",{});var P=m(V);j=w(P,R),P.forEach(n),X.forEach(n),F=q(f),v=p(f,"P",{});var Z=m(v);S=w(Z,"Your challenge code: "),b=p(Z,"B",{});var x=m(b);N=w(x,c[7]),x.forEach(n),Z.forEach(n),this.h()},h(){_(I,"class","generate-button-content svelte-ktq9ns"),_(A,"class","svelte-ktq9ns"),_(g,"class","confirm svelte-ktq9ns")},m(f,Y){C(f,e,Y),s(e,l),C(f,r,Y),C(f,t,Y),s(t,o),s(t,a),s(a,k),s(t,u),C(f,d,Y),C(f,g,Y),s(g,A),s(A,I),$.m(I,null),C(f,i,Y),C(f,y,Y),s(y,L),s(y,V),s(V,j),C(f,F,Y),C(f,v,Y),s(v,S),s(v,b),s(b,N),D||(B=Se(A,"click",c[8]),D=!0)},p(f,Y){M!==(M=K(f))&&($.d(1),$=M(f),$&&($.c(),$.m(I,null))),Y&64&&R!==(R=f[6].id+"")&&ie(j,R)},d(f){f&&n(e),f&&n(r),f&&n(t),f&&n(d),f&&n(g),$.d(),f&&n(i),f&&n(y),f&&n(F),f&&n(v),D=!1,B()}}}function lt(c){let e,l,r,t,o,a,k=c[6].id+"",u,d,g,A,I,i,y,L,V,R,j,F;return{c(){e=h("h2"),l=E("Verify"),r=T(),t=h("p"),o=E("Your DID: "),a=h("b"),u=E(k),d=T(),g=h("div"),A=h("label"),I=T(),i=h("input"),y=T(),L=h("a"),V=E("Verify on Instagram"),this.h()},l(v){e=p(v,"H2",{});var S=m(e);l=w(S,"Verify"),S.forEach(n),r=q(v),t=p(v,"P",{});var b=m(t);o=w(b,"Your DID: "),a=p(b,"B",{});var N=m(a);u=w(N,k),N.forEach(n),b.forEach(n),d=q(v),g=p(v,"DIV",{class:!0});var D=m(g);A=p(D,"LABEL",{for:!0}),m(A).forEach(n),I=q(D),i=p(D,"INPUT",{type:!0,name:!0,id:!0,placeholder:!0,class:!0}),y=q(D),L=p(D,"A",{href:!0,class:!0});var B=m(L);V=w(B,"Verify on Instagram"),B.forEach(n),D.forEach(n),this.h()},h(){_(A,"for","instagram-handle"),_(i,"type","text"),_(i,"name","instagram-handle"),_(i,"id","instagram-handle"),_(i,"placeholder","Instagram's handle e.g. wallkanda"),_(i,"class","svelte-ktq9ns"),_(L,"href",R=""+(de.IDENTITY_LINK_URL+"/api/v0/request-instagram?did="+c[6].id+"&username="+c[0])),_(L,"class","svelte-ktq9ns"),_(g,"class","verify svelte-ktq9ns")},m(v,S){C(v,e,S),s(e,l),C(v,r,S),C(v,t,S),s(t,o),s(t,a),s(a,u),C(v,d,S),C(v,g,S),s(g,A),s(g,I),s(g,i),Te(i,c[0]),s(g,y),s(g,L),s(L,V),j||(F=Se(i,"input",c[10]),j=!0)},p(v,S){S&64&&k!==(k=v[6].id+"")&&ie(u,k),S&1&&i.value!==v[0]&&Te(i,v[0]),S&65&&R!==(R=""+(de.IDENTITY_LINK_URL+"/api/v0/request-instagram?did="+v[6].id+"&username="+v[0]))&&_(L,"href",R)},d(v){v&&n(e),v&&n(r),v&&n(t),v&&n(d),v&&n(g),j=!1,F()}}}function qe(c){let e,l,r=c[3].data.attestation+"",t;return{c(){e=h("p"),l=E("Attestation: "),t=E(r)},l(o){e=p(o,"P",{});var a=m(e);l=w(a,"Attestation: "),t=w(a,r),a.forEach(n)},m(o,a){C(o,e,a),s(e,l),s(e,t)},p(o,a){a&8&&r!==(r=o[3].data.attestation+"")&&ie(t,r)},d(o){o&&n(e)}}}function rt(c){let e;return{c(){e=E("Generate Verifiable Credential")},l(l){e=w(l,"Generate Verifiable Credential")},m(l,r){C(l,e,r)},d(l){l&&n(e)}}}function nt(c){let e,l,r,t,o,a;return{c(){e=ue("svg"),l=ue("circle"),r=ue("path"),t=T(),o=h("p"),a=E("Generating..."),this.h()},l(k){e=fe(k,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var u=m(e);l=fe(u,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),m(l).forEach(n),r=fe(u,"path",{class:!0,fill:!0,d:!0}),m(r).forEach(n),u.forEach(n),t=q(k),o=p(k,"P",{});var d=m(o);a=w(d,"Generating..."),d.forEach(n),this.h()},h(){_(l,"class","opacity-25"),_(l,"cx","12"),_(l,"cy","12"),_(l,"r","10"),_(l,"stroke","currentColor"),_(l,"stroke-width","4"),_(r,"class","opacity-75"),_(r,"fill","currentColor"),_(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),_(e,"class","animate-spin -ml-1 mr-3 h-5 w-5 text-white dark:text-black"),_(e,"xmlns","http://www.w3.org/2000/svg"),_(e,"fill","none"),_(e,"viewBox","0 0 24 24")},m(k,u){C(k,e,u),s(e,l),s(e,r),C(k,t,u),C(k,o,u),s(o,a)},d(k){k&&n(e),k&&n(t),k&&n(o)}}}function ot(c){let e;function l(o,a){if(o[2]==o[1].VERIFY)return lt;if(o[2]==o[1].CONFIRM)return tt;if(o[2]==o[1].SUCCESS)return et}let r=l(c),t=r&&r(c);return{c(){e=h("section"),t&&t.c(),this.h()},l(o){e=p(o,"SECTION",{class:!0});var a=m(e);t&&t.l(a),a.forEach(n),this.h()},h(){_(e,"class","svelte-ktq9ns")},m(o,a){C(o,e,a),t&&t.m(e,null)},p(o,a){r===(r=l(o))&&t?t.p(o,a):(t&&t.d(1),t=r&&r(o),t&&(t.c(),t.m(e,null)))},d(o){o&&n(e),t&&t.d()}}}function Re(c){let e,l;return{c(){e=h("p"),l=E(c[4]),this.h()},l(r){e=p(r,"P",{class:!0});var t=m(e);l=w(t,c[4]),t.forEach(n),this.h()},h(){_(e,"class","error svelte-ktq9ns")},m(r,t){C(r,e,t),s(e,l)},p(r,t){t&16&&ie(l,r[4])},d(r){r&&n(e)}}}function st(c){let e,l,r,t,o,a,k,u,d,g,A,I,i,y,L,V,R,j,F,v,S,b,N,D,B,K,M,$,f,Y,z,te,le,H,re,X,P,Z,x;P=new xe({props:{$$slots:{default:[ot]},$$scope:{ctx:c}}});let U=c[4]&&Re(c);return{c(){e=T(),l=h("main"),r=h("section"),t=h("h1"),o=E("Verify your Instagram account through "),a=h("a"),k=E("Identity Link Services"),u=T(),d=h("p"),g=E("This project is an example of how you can issue a "),A=h("a"),I=E("verifiable credential"),i=E(`
			that link a decentralized identifier (DID) to your Instagram account on
			`),y=h("a"),L=E("Ceramic network"),V=E(". It is configured on the "),R=h("b"),j=E("clay testnet"),F=E(" network."),v=T(),S=h("h2"),b=E("Instructions:"),N=T(),D=h("ol"),B=h("li"),K=E("Connect with Metamask and 3ID"),M=T(),$=h("li"),f=E(`Click on the button to authorize our app to access your Instagram account (you will be
				redirected to Instagram Log In).`),Y=T(),z=h("li"),te=E("Authorize our app (read-only access), you will be redirected to this same page."),le=T(),H=h("li"),re=E("Connect again and generate your verifiable credential by clicking on the button"),X=T(),Ce(P.$$.fragment),Z=T(),U&&U.c(),this.h()},l(O){Fe('[data-svelte="svelte-1t13h6n"]',document.head).forEach(n),e=q(O),l=p(O,"MAIN",{class:!0});var W=m(l);r=p(W,"SECTION",{class:!0});var J=m(r);t=p(J,"H1",{});var ce=m(t);o=w(ce,"Verify your Instagram account through "),a=p(ce,"A",{href:!0,rel:!0,target:!0});var _e=m(a);k=w(_e,"Identity Link Services"),_e.forEach(n),ce.forEach(n),u=q(J),d=p(J,"P",{});var G=m(d);g=w(G,"This project is an example of how you can issue a "),A=p(G,"A",{href:!0,rel:!0,target:!0});var he=m(A);I=w(he,"verifiable credential"),he.forEach(n),i=w(G,`
			that link a decentralized identifier (DID) to your Instagram account on
			`),y=p(G,"A",{href:!0,rel:!0,target:!0});var pe=m(y);L=w(pe,"Ceramic network"),pe.forEach(n),V=w(G,". It is configured on the "),R=p(G,"B",{});var me=m(R);j=w(me,"clay testnet"),me.forEach(n),F=w(G," network."),G.forEach(n),v=q(J),S=p(J,"H2",{});var ve=m(S);b=w(ve,"Instructions:"),ve.forEach(n),N=q(J),D=p(J,"OL",{class:!0});var Q=m(D);B=p(Q,"LI",{});var be=m(B);K=w(be,"Connect with Metamask and 3ID"),be.forEach(n),M=q(Q),$=p(Q,"LI",{});var ye=m($);f=w(ye,`Click on the button to authorize our app to access your Instagram account (you will be
				redirected to Instagram Log In).`),ye.forEach(n),Y=q(Q),z=p(Q,"LI",{});var ke=m(z);te=w(ke,"Authorize our app (read-only access), you will be redirected to this same page."),ke.forEach(n),le=q(Q),H=p(Q,"LI",{});var ge=m(H);re=w(ge,"Connect again and generate your verifiable credential by clicking on the button"),ge.forEach(n),Q.forEach(n),J.forEach(n),X=q(W),Ae(P.$$.fragment,W),Z=q(W),U&&U.l(W),W.forEach(n),this.h()},h(){document.title="Ceramic Identity Link - Instagram",_(a,"href","https://github.com/ceramicstudio/identitylink-services"),_(a,"rel","external noopener"),_(a,"target","_blank"),_(A,"href","https://www.w3.org/TR/vc-data-model/"),_(A,"rel","external noopener"),_(A,"target","_blank"),_(y,"href","https://ceramic.network/"),_(y,"rel","external noopener"),_(y,"target","_blank"),_(D,"class","instructions svelte-ktq9ns"),_(r,"class","svelte-ktq9ns"),_(l,"class","svelte-ktq9ns")},m(O,ee){C(O,e,ee),C(O,l,ee),s(l,r),s(r,t),s(t,o),s(t,a),s(a,k),s(r,u),s(r,d),s(d,g),s(d,A),s(A,I),s(d,i),s(d,y),s(y,L),s(d,V),s(d,R),s(R,j),s(d,F),s(r,v),s(r,S),s(S,b),s(r,N),s(r,D),s(D,B),s(B,K),s(D,M),s(D,$),s($,f),s(D,Y),s(D,z),s(z,te),s(D,le),s(D,H),s(H,re),s(l,X),De(P,l,null),s(l,Z),U&&U.m(l,null),x=!0},p(O,[ee]){const W={};ee&524399&&(W.$$scope={dirty:ee,ctx:O}),P.$set(W),O[4]?U?U.p(O,ee):(U=Re(O),U.c(),U.m(l,null)):U&&(U.d(1),U=null)},i(O){x||(oe(P.$$.fragment,O),x=!0)},o(O){ne(P.$$.fragment,O),x=!1},d(O){O&&n(e),O&&n(l),Le(P),U&&U.d()}}}const ft=!0,Ne="instagram.com";function at(c,e,l){let r,t,o;ae(c,We,b=>l(6,r=b)),ae(c,He,b=>l(12,t=b)),ae(c,Je,b=>l(13,o=b));var a;let k;const u=o.query.get("code")||"";let d=((a=o.query.get("state"))===null||a===void 0?void 0:a.replace("#_",""))||"";console.log(d?`Challenge Code: ${d}`:"No challenge code found in URL Query Params, starting at step 1: VERIFY");const g=o.query.get("error"),A=o.query.get("error_reason"),I=o.query.get("error_description");var i;(function(b){b[b.VERIFY=0]="VERIFY",b[b.CONFIRM=1]="CONFIRM",b[b.SUCCESS=2]="SUCCESS"})(i||(i={}));let y=u?i.CONFIRM:i.VERIFY,L,V,R=!1;Me(()=>{g&&l(4,V=`Facebook Login Error: ${g}, ${A}, ${I}`)});async function j(){try{l(5,R=!0);const b=await t.createJWS({challengeCode:d});console.log(b);const N=await fetch(`${de.IDENTITY_LINK_URL}/api/v0/confirm-instagram`,{method:"post",body:JSON.stringify({jws:b,code:u})});if(!N.ok){let D="";try{l(3,L=await N.json()),console.log(L),D=L.message}catch(B){console.log(B)}throw l(4,V=`There was a problem: ${N.status} status code, ${D}`),new Error(V)}l(3,L=await N.json()),console.log(L),l(2,y=i.SUCCESS),await v(L.data.attestation),alert("Congrats, you linked your Instagram account to your 3ID account with a Verifiable Credential.")}catch(b){console.error(b),l(4,V=b)}finally{l(5,R=!1)}}function F(b){return Pe(b).payload.vc.credentialSubject.account.username}async function v(b){var N,D,B;const K=(D=await((N=r.client.dataStore.get("alsoKnownAs",t.id))===null||N===void 0?void 0:N.accounts))!==null&&D!==void 0?D:[],M=F(b),$=K.find(f=>f.host===Ne&&f.id===M);$==null?K.push({protocol:"https",host:Ne,id:M,attestations:[{"did-jwt-vc":b}]}):($.attestations=(B=$.attestations)!==null&&B!==void 0?B:[],$.attestations.push({"did-jwt-vc":b})),await r.client.dataStore.set("alsoKnownAs",{accounts:K}),console.log("Added attestation to AlsoKnownAsAccounts")}function S(){k=this.value,l(0,k)}return[k,i,y,L,V,R,r,d,j,v,S]}class dt extends Ie{constructor(e){super();Ee(this,e,at,st,we,{addInstagramAttestation:9})}get addInstagramAttestation(){return this.$$.ctx[9]}}export{dt as default,ft as prerender};
